#ifndef PGA_hh
#define PGA_hh 1

#include "G4VUserPrimaryGeneratorAction.hh"
#include "G4SystemOfUnits.hh"
#include "G4ParticleGun.hh"
#include "Randomize.hh"

//#include "TFile.h"
//#include "TH2.h"

class G4GeneralParticleSource;
class G4Event;

// PGA class creates the particle gun at a specified location and
// in a specified direction with a specific particle. It is also 
// responsible for generating each event. 

class PGA : public G4VUserPrimaryGeneratorAction
{
public:
  PGA();
  ~PGA();

  G4GeneralParticleSource *GetSource() {return particleSource;}

  //G4ParticleGun *GetSource() {return particleSource;}

  void GeneratePrimaries(G4Event *);

  //std::vector<G4double> GenerateCosE(G4double incident_E, G4double m_A, G4double m_B,G4double m_C,G4double m_D,G4double Q_value);
  G4double CosToE(G4double cos, G4double m_A, G4double m_B,G4double m_C,G4double m_D,G4double E_in,G4double Q_value);
  
private:
  G4RandGeneral* alpha_generator = 0;

  G4RandGeneral* action_generator = 0;

  G4GeneralParticleSource* particleSource;
  //G4ParticleGun* particleSource;
  G4int E_alpha_size = 124;
  G4double* E_alpha_array = new G4double[E_alpha_size];

  std::vector<G4double> E_in_vec = 
        {0.00016015673204898743,0.00012920206955212431,0.0001924572494370185,0.00020860750813103405,0.00023283289617205734,0.00022879533149855352,0.00024494559019256896,0.00027859196247176805,0.0002489831548660729,0.0002718626880159283,0.0002664792684512564,0.0002839753820364399,0.00029877978583928746,0.00031627589942447097,0.00031358418964213506,0.0005100790037526575,0.0032488937072794595,0.0005356502466848488,0.00034050128746549433,0.00034184714235666226,0.0003606891108330137,0.00047374092169112246,0.0006850401396044926,0.0007644455781834023,0.0008357758874153042,0.0008223173385036247,0.0008196256287212885,0.0008667305499121674,0.0008963393575178623,0.0008344300325241362,0.0008451968716534799,0.0008438510167623119,0.0009272940200147255,0.0008734598243680072,0.0008882642281708548,0.0008680764048033352,0.0008963393575178623,0.0008923017928443585,0.0008828808086061828,0.0009394067140352372,0.0009367150042529014,0.0011103302852135683,0.001119751269451744,0.0012422240645480285,0.0014212227650733675,0.0014938989291964373,0.001580033642231187,0.0016204092889662257,0.0018936178318733217,0.001889580267199818,0.0017644157623211978,0.001753648923191854,0.0018922719769821543,0.0019932110938197514,0.002394275851387804,0.0028841670317729423,0.0037428224523381017,0.0011668561906426228,0.0012758704368272275,0.0013108626639975946,0.0015598458188636674,0.001507357478108117,0.0016029131753810425,0.0016648225003747684,0.001861317314485291,0.0018801592829616424,0.0018330543617707637,0.0018330543617707637,0.0019514895921935445,0.0019582188666493845,0.0025073276622459124,0.002531553050286936,0.00272670200950629,0.003095466249686312,0.003115654073053831,0.003501914426819036,0.0037132136447324063,0.00016015673204898743,0.0009017227770825344,0.0009071061966472062,0.0008855725183885188,0.00097709065098794,0.0008007836602449372,0.0009178730357765498,0.0009420984238175732,0.0009178730357765498,0.0008209714836124565,0.0008640388401298314,0.0009017227770825344,0.0008209714836124565,0.0009044144868648702,0.0007846334015509216,0.0009394067140352372,0.0008707681145856712,0.005033497292968177,0.0010887966069548808,0.0009851657803349478,0.0010403458308728343,0.0009272940200147255,0.0010228497172876509,0.0010941800265195528,0.0010295789917434907,0.0010968717363018887,0.0010470751053286741,0.0009865116352261159,0.0011332098183634237,0.001152051786839775,0.0011076385754312324,0.0010982175911930566,0.0009824740705526118,0.002991835423066379,0.004057752496871405,0.004390178654989891,0.0074614195166351795,0.008719793839877223,0.014506969871899459,0.0170802444238126,0.02926292289866499,0.039222249093307904,0.04852748981084319,0.03672972583486484,0.03633135278707913,0.04372413370426474,0.053784399015745256};

  G4double E_min = 1011.6*keV;
  G4double E_max = 2230.35*keV;

  std::vector<G4double*> Hist_points;
  std::vector<G4RandGeneral*> Generators;

  G4double A_masses;
  G4double A_energy;
  G4double A;
  G4double B_masses;
  G4double B_energy;
  G4double B;
  G4double C_masses;
  G4double C_energy;
  G4double C;
  G4double D_masses;
  G4double D_energy;
  G4double D;

  G4double E_incident;
  std::vector<G4double> Particle_info = {};

  G4double m_a = 13.003355;
  G4double m_b = 4.002603;
  G4double m_c = 15.994915;
  G4double m_d = 1.008665;
  G4double Q = 2.216*MeV;

  G4bool UseFancyStuff = false;

};

#endif
